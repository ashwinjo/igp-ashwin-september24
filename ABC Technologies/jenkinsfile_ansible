---
- name: Build, tag, and push Docker image
  hosts: docker_hosts
  become: true
  tasks:
    - name: Build Docker image
      community.docker.docker_image:
        name: igpabctech # Name of the image
        tag: $BUILD_NUMBER   # Tag for the image
        build:
          path: Dockerfile  # Path to the directory containing Dockerfile
        push: false  # Set to true if you want to push immediately after building

    - name: Tag Docker image
      community.docker.docker_image:
        name: igpabctech:$BUILD_NUMBER  # Source image
        repository: ashjo317/igp-devops  # Target repository (Docker Hub or private registry)
        tag: $BUILD_NUMBER  # New tag to apply

    - name: Push Docker image to registry
      community.docker.docker_image:
        name: ashjo317/igp-devops:$BUILD_NUMBER  # Full name of the image to push
        push: true  # Push the image to the repository
